{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">Your Orders</h2>

    <!-- Search Form -->
    <form method="get" action="" class="d-flex mb-3">
        <input type="text" name="search" class="form-control me-2" placeholder="Search orders..." value="{{ request.GET.search }}">
        <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i></button>
    </form>

    <!-- Orders Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Total Amount</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if page_obj %}
                    {% for order in page_obj %}
                    <tr>
                        <td>{{ order.id }}</td>
                        <td>{{ order.order_date }}</td>
                        <td>
                            <span class="badge 
                                {% if order.status == 'Pending' %} bg-warning 
                                {% elif order.status == 'Processing' %} bg-warning 
                                {% elif order.status == 'Completed' %} bg-success 
                                {% elif order.status == 'Shipped' %} bg-success 
                                {% elif order.status == 'Cancelled' %} bg-danger 
                                {% else %} bg-secondary {% endif %}">
                                {{ order.status }}
                            </span>
                        </td>
                        <td>${{ order.total_amount }}</td>
                        <td>
                            <a href="{% url 'orders:order_detail' order.id %}" class="btn btn-sm btn-info">View</a>
                            <a href="{% url 'orders:update_order_status' order.id %}" class="btn btn-sm btn-warning">Update Status</a>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No orders found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <nav class="mt-4">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page=1{% if request.GET.urlencode %}&{{ request.GET.urlencode }}{% endif %}">First</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.urlencode %}&{{ request.GET.urlencode }}{% endif %}">‹</a></li>
            {% endif %}

            {% for page in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == page %}active{% endif %}">
                    <a class="page-link" href="?page={{ page }}{% if request.GET.urlencode %}&{{ request.GET.urlencode }}{% endif %}">{{ page }}</a>
                </li>
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.urlencode %}&{{ request.GET.urlencode }}{% endif %}">›</a></li>
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.urlencode %}&{{ request.GET.urlencode }}{% endif %}">Last</a></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}
